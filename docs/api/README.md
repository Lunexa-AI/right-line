# API Documentation (v2.0)

## Overview

Gweta provides a RESTful API for advanced legal information queries. The v2.0 API is stateful, personalized, and built around an agentic RAG (Retrieval-Augmented Generation) engine.

## Base URL

- **Production**: `https://gweta.vercel.app/api`
- **Local**: `http://localhost:3000/api`

## Authentication

Authentication is mandatory for all core endpoints and is handled via **Firebase Authentication**. Clients must acquire a JWT token from Firebase and include it in the `Authorization` header for every request.

**Flow**:
1.  Client authenticates with Firebase (e.g., using Firebase SDK for Web).
2.  Firebase returns a JWT token.
3.  Client sends this token with every API request.

```bash
curl -H "Authorization: Bearer <FIREBASE_JWT_TOKEN>" \
     https://gweta.vercel.app/api/v1/query
```

## Endpoints

### Query Endpoint

**POST** `/v1/query`

Submits a legal question to the agentic engine. This is a stateful endpoint that can use a `session_id` to maintain conversational context.

#### Request Body

```json
{
  "text": "What is the penalty for theft?",
  "session_id": "user_session_abc123",
  "lang_hint": "en",
  "date_ctx": "2024-01-01",
  "channel": "web"
}
```
- `text` (string, required): The user's query.
- `session_id` (string, optional): An ID to link conversational turns. If omitted, a new conversation context may be created.

#### Response Body (`200 OK`)

```json
{
  "tldr": "Theft can result in imprisonment for up to 10 years, or a fine, or both, depending on the circumstances.",
  "key_points": [
    "The maximum penalty for theft is imprisonment up to 10 years.",
    "A fine may be imposed as an alternative or in addition.",
    "The court considers the value of stolen property and other factors."
  ],
  "citations": [
    {
      "title": "Criminal Law (Codification and Reform) Act",
      "url": "https://...",
      "page": null,
      "sha": null
    }
  ],
  "suggestions": [
    "What factors does a court consider when sentencing for theft?",
    "Tell me more about the Criminal Law (Codification and Reform) Act"
  ],
  "confidence": 0.92,
  "source": "hybrid",
  "request_id": "req_167...",
  "processing_time_ms": 2345
}
```

### Session History Endpoints

#### Get All Sessions

**GET** `/v1/sessions`

Retrieves a list of past conversation sessions for the authenticated user.

#### Get Session Messages

**GET** `/v1/sessions/{session_id}`

Retrieves all messages (user and assistant) for a specific session.

### Feedback Endpoint

**POST** `/v1/feedback`

Submits user feedback on a specific query response.

#### Request Body

```json
{
  "request_id": "req_167...",
  "rating": 1,
  "comment": "This was a very helpful and accurate answer."
}
```
- `rating` (integer): `1` for thumbs up, `-1` for thumbs down.

### Health Check

**GET** `/healthz`

Checks if the API service is alive. Does not require authentication.

#### Response

```json
{
  "status": "healthy",
  "service": "api",
  "version": "2.0.0",
  "timestamp": 1678886400.0
}
```

## Error Responses

Standard HTTP status codes are used.

### 401 Unauthorized

Returned if the JWT token is missing, invalid, or expired.

```json
{
  "detail": "Not authenticated"
}
```

### 422 Unprocessable Entity

Returned if the request body fails validation.

```json
{
  "detail": [
    {
      "loc": ["body", "text"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

### 500 Internal Server Error

Returned for any unexpected server-side errors.

```json
{
  "detail": "Internal server error. Please try again later."
}
```

## OpenAPI Specification

The full OpenAPI 3.0 specification is automatically generated by FastAPI and available at:
- **Interactive Docs**: `/docs`
- **ReDoc**: `/redoc`
- **JSON Specification**: `/openapi.json`

These are available on the running server (e.g., `http://localhost:3000/docs`).

## Support

For API support, please use the repository's [GitHub Issues](https://github.com/Lunexa-AI/right-line/issues).
